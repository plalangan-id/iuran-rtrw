<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PLALANGAN.NET - EXECUTIVE ADMIN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: #0f1115;
            color: #ffffff; 
            min-height: 100vh;
            padding-bottom: 50px;
        }

        #login-page {
            position: fixed; inset: 0; background: #0f1115;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 2000; padding: 20px;
        }

        .stat-box {
            background: linear-gradient(145deg, #1a1d24, #14161b);
            border-radius: 18px;
            padding: 12px 5px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.03);
        }

        .neon-red { color: #ff3131; text-shadow: 0 0 10px rgba(255, 49, 49, 0.6); }
        .neon-green { color: #39ff14; text-shadow: 0 0 10px rgba(57, 255, 20, 0.6); }
        .neon-blue { color: #00d2ff; text-shadow: 0 0 10px rgba(0, 210, 255, 0.6); }
        .neon-orange { color: #ff9100; text-shadow: 0 0 10px rgba(255, 145, 0, 0.6); }

        .icon-menu {
            @apply flex flex-col items-center justify-center transition-all duration-300;
            background: transparent; padding: 10px; border: none;
        }
        .icon-menu:active { transform: scale(0.85); opacity: 0.6; }
        .icon-menu span { 
            font-size: 45px; margin-bottom: 8px;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5));
        }
        .icon-menu p { font-size: 8px; font-weight: 800; letter-spacing: 0.1em; color: #ffffffad; }

        .search-container {
            background: #1a1d24; border-radius: 24px; padding: 2px 25px;
            width: 100%; display: flex; align-items: center;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(10, 12, 16, 0.98); 
            backdrop-filter: blur(25px); display: none; flex-direction: column;
            z-index: 1000; padding: 20px;
        }
        
        .modal-content-scroll { width: 100%; max-width: 600px; margin: 0 auto; flex-grow: 1; overflow-y: auto; padding-bottom: 100px; }

        /* TOMBOL KEMBALI LINGKARAN KECIL */
        .btn-back {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: #ef444403; color: white; width: 55px; height: 55px;
            border-radius: 50%; font-size: 24px; display: flex; align-items: center; justify-content: center;
            z-index: 1100; box-shadow: 0 10px 20px rgba(239, 68, 68, 0.4);
        }

        .input-premium { background: #252932; border-radius: 18px; padding: 18px; width: 100%; color: white; outline: none; margin-bottom: 12px; }

        table { width: 100%; border-collapse: collapse; }
        th { color: #ffffff; font-size: 9px; text-transform: uppercase; letter-spacing: 1px; padding: 12px 8px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        td { padding: 12px 8px; border-bottom: 1px solid rgba(255,255,255,0.03); }
        
        /* MENGHAPUS SEMUA TEXT MIRING */
        * { font-style: normal !important; }

        .hidden-el { display: none; }
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="p-6">

    <div id="login-page">
        <h1 class="text-3xl font-black mb-8 uppercase tracking-tighter">ADMIN ACCESS</h1>
        <input type="password" id="admin-pass" placeholder="PASSWORD" class="input-premium text-center mb-4 w-full max-w-xs">
        <button onclick="checkLogin()" class="w-full max-w-xs bg-white text-black p-5 rounded-2xl font-black">LOGIN</button>
    </div>

    <div class="text-center mb-8 mt-4">
        <h1 class="text-4xl font-black tracking-tighter uppercase">PLALANGAN.NET</h1>
        <p class="text-[10px] font-bold text-gray-500 uppercase tracking-[0.4em]">Executive Admin System</p>
    </div>

    <div class="grid grid-cols-4 gap-2 mb-10">
        <div class="stat-box">
            <p class="text-[7px] font-bold text-gray-500 mb-1">BELUM</p>
            <h2 id="stat-belum" class="text-lg font-black neon-red">0</h2>
        </div>
        <div class="stat-box">
            <p class="text-[7px] font-bold text-gray-500 mb-1">MASUK</p>
            <h2 id="stat-uang" class="text-[11px] font-black neon-green">0</h2>
        </div>
        <div class="stat-box">
            <p class="text-[7px] font-bold text-gray-500 mb-1">KELUAR</p>
            <h2 id="stat-keluar" class="text-[11px] font-black neon-orange">0</h2>
        </div>
        <div class="stat-box relative">
            <p class="text-[7px] font-bold text-gray-500 mb-1">SALDO</p>
            <h2 id="stat-saldo" class="text-[11px] font-black neon-blue">0</h2>
            <button onclick="togglePrivacy()" class="absolute bottom-1 right-1 text-[8px] opacity-20" id="eye-icon">üëÅÔ∏è</button>
        </div>
    </div>

    <div class="grid grid-cols-3 gap-y-12 mb-12">
        <button onclick="openM('tagihan', 'all')" class="icon-menu"><span>üßæ</span><p>TAGIHAN</p></button>
        <button onclick="openM('tagihan', 'belum')" class="icon-menu"><span>‚è≥</span><p>BELUM</p></button>
        <button onclick="openM('tagihan', 'lunas')" class="icon-menu"><span>‚úÖ</span><p>LUNAS</p></button>
        <button onclick="openM('master')" class="icon-menu"><span>üë•</span><p>MEMBER</p></button>
        <button onclick="openM('tambah')" class="icon-menu"><span>‚ûï</span><p>BARU</p></button>
        <button onclick="openM('gen')" class="icon-menu"><span>‚ö°</span><p>BUAT</p></button>
        <button onclick="openM('pengeluaran')" class="icon-menu"><span>üí∏</span><p>KELUAR</p></button>
        <button onclick="openM('rekap')" class="icon-menu"><span>üìà</span><p>REKAP</p></button>
        <button onclick="logout()" class="icon-menu"><span>üîí</span><p>LOGOUT</p></button>
    </div>

    <div class="search-container mb-4">
        <input type="text" id="main-search" oninput="liveSearch()" placeholder="CARI NAMA ..." class="bg-transparent h-16 outline-none font-bold text-sm w-full uppercase">
        <span class="text-xl">üîç</span>
    </div>

    <div id="search-results-area" class="search-results mt-4"></div>

    <div id="modal-container" class="modal-overlay">
        <div class="modal-content-scroll">
            <div id="m-list" class="hidden-el">
                <h3 id="modal-title" class="text-2xl font-black mb-8 uppercase text-center tracking-tighter">Daftar</h3>
                <div id="list-render"></div>
            </div>

            <div id="m-pengeluaran" class="hidden-el pt-6">
                <h3 class="text-2xl font-black mb-4 uppercase text-center neon-orange">Catatan Keluar</h3>
                <div class="bg-[#1a1d24] p-5 rounded-3xl mb-6 border border-white/5">
                    <input type="date" id="item-tgl" class="input-premium !bg-[#0f1115] !text-xs mb-2">
                    <input type="text" id="item-nama" class="input-premium !bg-[#0f1115]" placeholder="KEPERLUAN">
                    <input type="number" id="item-harga" class="input-premium !bg-[#0f1115]" placeholder="NOMINAL (Rp)">
                    <button onclick="tambahItem()" class="w-full bg-orange-600 p-4 rounded-2xl font-black uppercase text-xs">Simpan Item</button>
                </div>
                <div class="bg-[#1a1d24] rounded-2xl overflow-hidden border border-white/5">
                    <table>
                        <thead><tr class="bg-white/5"><th>TGL</th><th>ITEM</th><th class="text-right">RP</th><th></th></tr></thead>
                        <tbody id="body-tabel-keluar"></tbody>
                    </table>
                </div>
                <div class="mt-4 text-center">
                    <button onclick="resetTabel()" class="text-[9px] text-gray-600 font-bold uppercase tracking-widest">Hapus Semua Data Pengeluaran</button>
                </div>
            </div>

            <div id="m-tambah" class="hidden-el pt-6 text-center">
                <h3 class="text-2xl font-black mb-8 uppercase">Registrasi Member</h3>
                <input type="text" id="new-nama" placeholder="NAMA LENGKAP" class="input-premium font-bold uppercase">
                <input type="number" id="new-nominal" placeholder="NOMINAL TAGIHAN" class="input-premium font-bold">
                <input type="number" id="new-aktivasi" placeholder="TGL PENAGIHAN" class="input-premium font-bold">
                <button onclick="tambahPelanggan()" class="w-full bg-blue-600 p-5 rounded-2xl font-black">SIMPAN</button>
            </div>

            <div id="m-gen" class="hidden-el pt-10 text-center">
                <h3 class="text-2xl font-black mb-6 uppercase">Generate Tagihan</h3>
                <div class="flex gap-2 mb-4">
                    <select id="bln-gen" class="input-premium font-black text-center flex-1">
                        <option value="Januari">JANUARI</option><option value="Februari">FEBRUARI</option>
                        <option value="Maret">MARET</option><option value="April">APRIL</option>
                        <option value="Mei">MEI</option><option value="Juni">JUNI</option>
                        <option value="Juli">JULI</option><option value="Agustus">AGUSTUS</option>
                        <option value="September">SEPTEMBER</option><option value="Oktober">OKTOBER</option>
                        <option value="November">NOVEMBER</option><option value="Desember">DESEMBER</option>
                    </select>
                    <input type="number" id="thn-gen" value="2026" class="input-premium font-black text-center w-32">
                </div>
                <button onclick="prosesGenerate()" class="w-full bg-emerald-600 p-5 rounded-2xl font-black">PROSES</button>
            </div>
            <div id="m-rekap" class="hidden-el pt-10"><div id="list-rekap" class="space-y-3"></div></div>
        </div>
        <button onclick="closeM()" class="btn-back">‚Üê</button>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbyAcOfX4c7FZymt_IZ0OWHovjkF0blutV8WDRHMzNF3uyVx8pB8J6P0NkBQAeh_pzpy/exec";
        let dataTagihan = [], dataMaster = [], listKeluar = [];
        let isPrivate = false;

        function checkLogin() {
            if(document.getElementById('admin-pass').value === "admin251287") {
                document.getElementById('login-page').style.display = 'none';
                sessionStorage.setItem('isAdmin', 'true');
            } else { alert("Password Salah!"); }
            
        }

        function togglePrivacy() { isPrivate = !isPrivate; updateStats(); }
        function logout() { sessionStorage.removeItem('isAdmin'); location.reload(); }

        async function load() {
            try {
                const res = await fetch(`${API_URL}?action=read`);
                const json = await res.json();
                dataTagihan = json.tagihan || [];
                dataMaster = json.master || [];
                listKeluar = JSON.parse(localStorage.getItem('plalangan_tabel_keluar')) || [];
                updateStats();
            } catch(e) { console.log("Load Error"); }
        }

        function updateStats() {
            const belum = dataTagihan.filter(d => String(d.lunas).toLowerCase() == "false").length;
            const masuk = dataTagihan.filter(d => String(d.lunas).toLowerCase() == "true").reduce((s, i) => s + Number(i.jumlah), 0);
            const keluar = listKeluar.reduce((s, i) => s + Number(i.harga), 0);
            const saldo = masuk - keluar;

            document.getElementById('stat-belum').innerText = belum;
            document.getElementById('stat-uang').innerText = isPrivate ? "******" : masuk.toLocaleString('id-ID');
            document.getElementById('stat-keluar').innerText = isPrivate ? "******" : keluar.toLocaleString('id-ID');
            document.getElementById('stat-saldo').innerText = isPrivate ? "******" : saldo.toLocaleString('id-ID');
            renderTabelKeluar();
        }

        function tambahItem() {
            const t = document.getElementById('item-tgl').value, n = document.getElementById('item-nama').value, h = document.getElementById('item-harga').value;
            if(!t || !n || !h) return alert("Isi Lengkap!");
            listKeluar.push({ id: Date.now(), tgl: t, nama: n.toUpperCase(), harga: Number(h) });
            localStorage.setItem('plalangan_tabel_keluar', JSON.stringify(listKeluar));
            document.getElementById('item-nama').value = ""; document.getElementById('item-harga').value = "";
            updateStats();
        }

        function renderTabelKeluar() {
            const b = document.getElementById('body-tabel-keluar'); if(!b) return; b.innerHTML = "";
            listKeluar.sort((x,y) => new Date(y.tgl) - new Date(x.tgl)).forEach(i => {
                b.innerHTML += `<tr>
                    <td class="text-gray-500 text-[9px]">${i.tgl.split('-').reverse().slice(0,2).join('/')}</td>
                    <td class="font-bold text-[10px] uppercase">${i.nama}</td>
                    <td class="text-right font-black neon-orange text-[10px]">Rp${i.harga.toLocaleString()}</td>
                    <td class="text-right"><button onclick="hapusRow(${i.id})" class="text-red-500 px-1 font-bold">√ó</button></td>
                </tr>`;
            });
        }

        function hapusRow(id) { listKeluar = listKeluar.filter(i => i.id !== id); localStorage.setItem('plalangan_tabel_keluar', JSON.stringify(listKeluar)); updateStats(); }
        function resetTabel() { if(confirm("Hapus semua?")) { listKeluar=[]; localStorage.removeItem('plalangan_tabel_keluar'); updateStats(); } }

        function liveSearch() {
            const val = document.getElementById('main-search').value.toUpperCase();
            const area = document.getElementById('search-results-area');
            if(val === "") { area.style.display = 'none'; return; }
            area.style.display = 'block'; area.innerHTML = "";
            dataTagihan.filter(d => d.nama.toUpperCase().includes(val)).forEach(h => {
                const isLunas = String(h.lunas).toLowerCase() == "true";
                area.innerHTML += `
                <div class="bg-[#1a1d24] p-5 rounded-2xl mb-3 flex justify-between items-center border-l-4 ${isLunas?'border-green-500':'border-red-500'}" onclick="if(!${isLunas}) bayar('${h.id}')">
                    <div><p class="text-sm font-bold uppercase">${h.nama}</p><p class="text-[9px] text-gray-500 font-bold uppercase">${h.bulan}</p></div>
                    <p class="text-sm font-black ${isLunas ? 'text-green-500' : 'text-white'}">Rp${Number(h.jumlah).toLocaleString()}</p>
                </div>`;
            });
        }

        function openM(type, filter = 'all') {
            document.getElementById('modal-container').style.display = 'flex';
            ['m-list', 'm-tambah', 'm-gen', 'm-rekap', 'm-pengeluaran'].forEach(id => document.getElementById(id).classList.add('hidden-el'));
            if(type === 'tagihan' || type === 'master') {
                document.getElementById('m-list').classList.remove('hidden-el');
                document.getElementById('modal-title').innerText = type === 'master' ? 'MEMBER' : filter.toUpperCase();
                renderToModal(type, filter);
            } else {
                document.getElementById('m-' + type).classList.remove('hidden-el');
                if(type === 'rekap') hitungRekap();
                if(type === 'pengeluaran') { document.getElementById('item-tgl').value = new Date().toISOString().split('T')[0]; renderTabelKeluar(); }
            }
        }

        function renderToModal(type, filter) {
            const container = document.getElementById('list-render'); container.innerHTML = "";
            let source = (type === 'tagihan') ? dataTagihan : dataMaster;
            if (type === 'tagihan') {
                if (filter === 'belum') source = source.filter(d => String(d.lunas).toLowerCase() == "false");
                if (filter === 'lunas') source = source.filter(d => String(d.lunas).toLowerCase() == "true");
            }

            if (type === 'master') {
                let tableHTML = `<div class="overflow-x-auto"><table><thead><tr><th class="text-left">NAMA</th><th class="text-left">AKTIVASI</th><th class="text-right">NOMINAL</th></tr></thead><tbody class="divide-y divide-white/5">`;
                source.forEach(h => {
                    tableHTML += `<tr><td class="py-4 px-2 text-xs font-black uppercase text-white">${h.nama}</td><td class="text-xs font-bold text-gray-500 px-2">${h.aktivasi || '-'}</td><td class="text-right px-2 text-xs font-bold text-blue-500">Rp${Number(h.nominal).toLocaleString()}</td></tr>`;
                });
                container.innerHTML = tableHTML + `</tbody></table></div>`;
                return;
            }

            let tableHTML = `<div class="overflow-x-auto"><table><thead><tr><th class="text-left">NAMA</th><th class="text-left">AKT</th><th class="text-left">BULAN</th><th class="text-left">TAHUN</th><th class="text-right">STATUS</th></tr></thead><tbody class="divide-y divide-white/5">`;
            source.forEach(h => {
                const isLunas = String(h.lunas).toLowerCase() == "true";
                const rowStyle = (!isLunas && type === 'tagihan') ? 'border-left: 4px solid #ef4444; background: rgba(239, 68, 68, 0.05);' : 'border-left: 4px solid transparent;';
                tableHTML += `
                <tr style="${rowStyle}" onclick="if(!${isLunas} && '${type}'=='tagihan') bayar('${h.id}')">
                    <td class="py-4 px-2">
                        <p class="text-xs font-black uppercase text-white">${h.nama}</p>
                        <p class="text-[9px] text-blue-500 font-bold uppercase">Rp${Number(h.jumlah || h.nominal).toLocaleString()}</p>
                    </td>
                    <td class="text-xs font-bold text-gray-500 px-2">${h.aktivasi || "-"}</td>
                    <td class="text-xs font-medium text-gray-500 uppercase px-2">${h.bulan || '-'}</td>
                    <td class="text-xs font-medium text-gray-500 px-2">${h.tahun || "2026"}</td>
                    <td class="text-right px-2">
                        <span class="px-2 py-1 rounded-md text-[8px] font-black uppercase ${isLunas ? 'bg-green-500/10 text-green-500' : 'bg-red-600 text-white'}">
                            ${isLunas ? 'Lunas' : 'Bayar'}
                        </span>
                    </td>
                </tr>`;
            });
            container.innerHTML = tableHTML + `</tbody></table></div>`;
        }

        function closeM() { document.getElementById('modal-container').style.display = 'none'; }
        async function bayar(id) { if(confirm("Lunas?")) { await fetch(`${API_URL}?action=update&id=${id}`); await load(); closeM(); } }
        
        function hitungRekap() {
            const list = document.getElementById('list-rekap'); list.innerHTML = "";
            let rekapBulan = {};
            dataTagihan.filter(d => String(d.lunas).toLowerCase() == "true").forEach(d => { rekapBulan[d.bulan] = (rekapBulan[d.bulan] || 0) + Number(d.jumlah); });
            Object.keys(rekapBulan).forEach(bln => {
                list.innerHTML += `<div class="flex justify-between p-5 bg-[#1a1d24] rounded-2xl mb-2 border border-white/5"><span class="font-bold uppercase text-gray-400">${bln}</span><span class="font-black text-green-400">Rp ${rekapBulan[bln].toLocaleString()}</span></div>`;
            });
        }

        async function tambahPelanggan() {
            const n = document.getElementById('new-nama').value, m = document.getElementById('new-nominal').value, a = document.getElementById('new-aktivasi').value;
            if(!n || !m) return alert("Isi!");
            await fetch(`${API_URL}?action=tambah_warga&nama=${encodeURIComponent(n)}&nominal=${m}&aktivasi=${a}`);
            closeM(); await load();
        }

        async function prosesGenerate() {
            const b = document.getElementById('bln-gen').value, t = document.getElementById('thn-gen').value;
            if(confirm(`Buat ${b}?`)) { await fetch(`${API_URL}?action=generate&bulan=${b}&tahun=${t}`); closeM(); await load(); }
        }

        window.onload = () => { if(sessionStorage.getItem('isAdmin') === 'true') document.getElementById('login-page').style.display = 'none'; load(); };
    </script>
</body>
</html>
